<!DOCTYPE html>
<html lang="uk">
<head>
<meta charset="UTF-8">
<title>Puzzle Game</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
*{box-sizing:border-box}
body{
  margin:0;
  font-family:system-ui,Arial;
  color:#f4efff;
  background:
    radial-gradient(900px 600px at 20% 20%, rgba(180,120,255,.25), transparent 60%),
    radial-gradient(900px 600px at 80% 30%, rgba(120,200,255,.15), transparent 60%),
    linear-gradient(180deg,#0b0616,#140a24);
}

/* HEADER */
header{
  display:flex;
  justify-content:space-between;
  align-items:center;
  padding:14px 20px;
  background:rgba(0,0,0,.45);
}
nav button{
  margin-left:6px;
  padding:8px 16px;
  border-radius:18px;
  border:1px solid rgba(255,255,255,.25);
  background:rgba(255,255,255,.08);
  color:#fff;
  cursor:pointer;
}
nav button.active{background:#9f6cff}

/* LAYOUT */
main{
  max-width:1200px;
  margin:30px auto;
  padding:0 20px;
}
section{display:none}
section.active{display:block}

/* CARD */
.card{
  max-width:720px;
  margin:0 auto;
  background:rgba(0,0,0,.4);
  border:1px solid rgba(255,255,255,.15);
  border-radius:18px;
  padding:22px;
}

/* FORM */
label{display:block;margin:12px 0 6px}
input,select{
  width:100%;
  padding:12px;
  border-radius:10px;
  border:1px solid rgba(255,255,255,.2);
  background:#000;
  color:#fff;
}
.actions{
  display:flex;
  justify-content:flex-end;
  gap:10px;
  margin-top:16px;
}
button{
  padding:10px 18px;
  border-radius:14px;
  border:1px solid rgba(255,255,255,.25);
  background:#222;
  color:#fff;
  cursor:pointer;
}
.primary{background:#9f6cff}
button:disabled{opacity:.5;cursor:not-allowed}

/* PREVIEW */
.preview{margin-top:14px;display:none}
.preview img{
  max-width:200px;
  border-radius:14px;
  border:2px solid rgba(255,255,255,.2);
}

/* GAME */
.topbar{
  display:flex;
  justify-content:space-between;
  align-items:center;
  margin-bottom:12px;
}
.canvas{
  position:relative;
  width:640px;
  height:640px;
  margin:0 auto;
  background:rgba(0,0,0,.35);
  border:2px dashed rgba(255,255,255,.3);
  border-radius:16px;
  overflow:hidden;
}
.piece{
  position:absolute;
  background-repeat:no-repeat;
  cursor:grab;
  border-radius:6px;
  box-shadow:0 6px 18px rgba(0,0,0,.6);
}

/* MODAL */
.modal{
  position:fixed;
  inset:0;
  background:rgba(0,0,0,.75);
  display:none;
  align-items:center;
  justify-content:center;
  z-index:999;
}
.modal.active{display:flex}
.modal img{
  max-width:90vw;
  max-height:85vh;
  border-radius:16px;
  border:2px solid #9f6cff;
}
</style>
</head>

<body>

<header>
  <strong>üß© Puzzle Game</strong>
  <nav>
    <button class="active" data-tab="create">Create</button>
    <button data-tab="play">Play</button>
  </nav>
</header>

<main>

<section id="create" class="active">
  <div class="card">
    <h2>Create Puzzle</h2>

    <label>Image</label>
    <input type="file" id="imgInput" accept="image/*">

    <div class="preview" id="preview">
      <img id="previewImg">
    </div>

    <label>Puzzle name</label>
    <input id="puzzleName" placeholder="Untitled">

    <label>Pieces</label>
    <select id="piecesCount">
      <option>10</option><option>20</option><option>32</option>
      <option>48</option><option selected>72</option>
      <option>100</option><option>144</option><option>196</option>
    </select>

    <div class="actions">
      <button id="cancelBtn">Cancel</button>
      <button class="primary" id="createBtn" disabled>Create & Play</button>
    </div>
  </div>
</section>

<section id="play">
  <div class="topbar">
    <div>‚è± <span id="timer">00:00</span></div>
    <button id="showImage">Image</button>
  </div>
  <div class="canvas" id="canvas"></div>
</section>

</main>

<div class="modal" id="imageModal" onclick="this.classList.remove('active')">
  <img id="fullImg">
</div>

<script>
/* TABS */
const tabs=document.querySelectorAll("nav button");
const sections=document.querySelectorAll("section");
tabs.forEach(b=>{
  b.onclick=()=>{
    tabs.forEach(x=>x.classList.remove("active"));
    b.classList.add("active");
    sections.forEach(s=>s.classList.remove("active"));
    document.getElementById(b.dataset.tab).classList.add("active");
  }
});

/* GAME STATE */
let imageData=null;
let timer=0, interval=null;

/* IMAGE UPLOAD */
imgInput.onchange=e=>{
  const file=e.target.files[0];
  if(!file) return;
  const r=new FileReader();
  r.onload=()=>{
    imageData=r.result;
    preview.style.display="block";
    previewImg.src=imageData;
    createBtn.disabled=false;
  };
  r.readAsDataURL(file);
};

/* CREATE */
createBtn.onclick=()=>{
  startGame(+piecesCount.value);
  tabs[1].click();
};

/* GAME LOGIC */
function startGame(count){
  const canvas=document.getElementById("canvas");
  canvas.innerHTML="";

  timer=0;
  clearInterval(interval);
  interval=setInterval(()=>{
    timer++;
    timerEl.textContent=
      String(timer/60|0).padStart(2,"0")+":"+
      String(timer%60).padStart(2,"0");
  },1000);

  const size=Math.round(Math.sqrt(count));
  const canvasSize=canvas.clientWidth;
  const pieceSize=canvasSize/size;

  for(let i=0;i<size*size;i++){
    const p=document.createElement("div");
    p.className="piece";
    p.style.width=p.style.height=pieceSize+"px";
    p.style.backgroundImage=`url(${imageData})`;
    p.style.backgroundSize=`${canvasSize}px ${canvasSize}px`;
    p.style.backgroundPosition=
      `${-(i%size)*pieceSize}px ${-Math.floor(i/size)*pieceSize}px`;

    p.style.left=Math.random()*(canvasSize-pieceSize)+"px";
    p.style.top=Math.random()*(canvasSize-pieceSize)+"px";

    p.onmousedown=e=>{
      const shiftX=e.offsetX, shiftY=e.offsetY;
      p.style.zIndex=1000;
      function move(ev){
        p.style.left=ev.pageX-canvas.offsetLeft-shiftX+"px";
        p.style.top=ev.pageY-canvas.offsetTop-shiftY+"px";
      }
      document.addEventListener("mousemove",move);
      document.onmouseup=()=>{
        document.removeEventListener("mousemove",move);
        document.onmouseup=null;
      };
    };

    canvas.appendChild(p);
  }
}

/* IMAGE PREVIEW */
showImage.onclick=()=>{
  fullImg.src=imageData;
  imageModal.classList.add("active");
};
</script>

</body>
</html>
