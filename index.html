<!DOCTYPE html>
<html lang="uk">
<head>
<meta charset="UTF-8">
<title>Puzzle Game</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
*{box-sizing:border-box}
body{
  margin:0;
  font-family:system-ui,Arial;
  background:linear-gradient(135deg,#1a0f2e,#0b0616);
  color:#fff;
}

/* HEADER */
header{
  display:flex;
  justify-content:space-between;
  align-items:center;
  padding:14px 20px;
  background:#0b0616;
}
nav button{
  margin-left:8px;
  padding:8px 16px;
  border-radius:16px;
  border:none;
  background:#2a1a4a;
  color:#fff;
  cursor:pointer;
}
nav button.active{background:#8b5cf6}

/* LAYOUT */
main{
  max-width:1200px;
  margin:30px auto;
  padding:0 20px;
}
section{display:none}
section.active{display:block}

/* CREATE */
.card{
  max-width:700px;
  margin:0 auto;
  background:#120a22;
  border-radius:18px;
  padding:20px;
}
input,select{
  width:100%;
  margin:10px 0;
  padding:10px;
  border-radius:10px;
  border:none;
}
button.primary{
  background:#8b5cf6;
  border:none;
  padding:10px 18px;
  border-radius:14px;
  cursor:pointer;
}

/* GAME */
#gameArea{
  position:relative;
  width:100%;
  height:650px;
  background:#2f2f2f;
  border-radius:12px;
  overflow:hidden;
}

/* PUZZLE PIECES */
.piece{
  position:absolute;
  background-repeat:no-repeat;
  cursor:grab;
  box-shadow:0 4px 12px rgba(0,0,0,.6);
}
</style>
</head>

<body>

<header>
  <strong>ðŸ§© Puzzle Game</strong>
  <nav>
    <button class="active" data-tab="create">Create</button>
    <button data-tab="play">Play</button>
  </nav>
</header>

<main>

<section id="create" class="active">
  <div class="card">
    <h2>Create Puzzle</h2>
    <input type="file" id="imgInput" accept="image/*">
    <select id="piecesCount">
      <option value="16">16</option>
      <option value="25">25</option>
      <option value="36">36</option>
      <option value="49">49</option>
      <option value="64">64</option>
    </select>
    <button class="primary" id="startBtn">Create & Play</button>
  </div>
</section>

<section id="play">
  <div id="gameArea"></div>
</section>

</main>

<script>
/* TABS */
document.querySelectorAll("nav button").forEach(btn=>{
  btn.onclick=()=>{
    document.querySelectorAll("nav button").forEach(b=>b.classList.remove("active"));
    btn.classList.add("active");
    document.querySelectorAll("section").forEach(s=>s.classList.remove("active"));
    document.getElementById(btn.dataset.tab).classList.add("active");
  };
});

let imageData=null;

/* IMAGE LOAD */
imgInput.onchange=e=>{
  const file=e.target.files[0];
  if(!file) return;
  const r=new FileReader();
  r.onload=()=>imageData=r.result;
  r.readAsDataURL(file);
};

/* START GAME */
startBtn.onclick=()=>{
  if(!imageData){alert("Upload image");return;}
  buildPuzzle(+piecesCount.value);
  document.querySelector('[data-tab="play"]').click();
};

function buildPuzzle(count){
  const area=document.getElementById("gameArea");
  area.innerHTML="";

  const img=new Image();
  img.onload=()=>{
    const cols=Math.round(Math.sqrt(count));
    const rows=cols;

    const pw=Math.floor(img.width/cols);
    const ph=Math.floor(img.height/rows);

    for(let y=0;y<rows;y++){
      for(let x=0;x<cols;x++){
        const p=document.createElement("div");
        p.className="piece";
        p.style.width=pw+"px";
        p.style.height=ph+"px";
        p.style.backgroundImage=`url(${imageData})`;
        p.style.backgroundPosition=`-${x*pw}px -${y*ph}px`;
        p.style.backgroundSize=`${img.width}px ${img.height}px`;

        p.style.left=Math.random()*(area.clientWidth-pw)+"px";
        p.style.top=Math.random()*(area.clientHeight-ph)+"px";

        enableDrag(p,area);
        area.appendChild(p);
      }
    }
  };
  img.src=imageData;
}

function enableDrag(el,container){
  el.onmousedown=e=>{
    const sx=e.offsetX, sy=e.offsetY;
    el.style.zIndex=1000;
    function move(ev){
      el.style.left=ev.pageX-container.offsetLeft-sx+"px";
      el.style.top=ev.pageY-container.offsetTop-sy+"px";
    }
    document.addEventListener("mousemove",move);
    document.onmouseup=()=>{
      document.removeEventListener("mousemove",move);
      document.onmouseup=null;
    };
  };
}
</script>

</body>
</html>
